# Telegram бот для записи на экзамен по математике

Бот для записи студентов на экзамены по математике (ОГЭ, ЕГЭ Проф, ЕГЭ База) с автоматическим сохранением данных в Google Sheets и системой напоминаний.

## Функционал

- Диалоговая система записи с выбором:
  - Типа экзамена (ОГЭ, ЕГЭ Проф, ЕГЭ База)
  - Дня недели (Суббота, Воскресенье)
  - Времени (зависит от выбранного дня)
  - Преподавателя (Анастасия, Василина)
  - Имени и фамилии
- Автоматическое сохранение данных в Google Sheets
- Система напоминаний с периодической проверкой:
  - Бот проверяет таблицу каждую минуту
  - Автоматически отправляет напоминания за час и за 15 минут до экзамена
  - При изменении времени экзамена в таблице напоминания автоматически пересчитываются

## Установка

1. Клонируйте репозиторий или скачайте файлы проекта

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example` и заполните необходимые переменные:
```bash
cp .env.example .env
```

4. Настройте Google Sheets API:
   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Создайте новый проект или выберите существующий
   - Включите Google Sheets API и Google Drive API
   - Создайте Service Account:
     - Перейдите в "IAM & Admin" → "Service Accounts"
     - Создайте новый Service Account
     - Скачайте JSON файл с ключами и сохраните как `credentials.json` в корне проекта
   - Откройте вашу Google таблицу и предоставьте доступ Service Account (скопируйте email из credentials.json)

5. Получите токен Telegram бота:
   - Найдите [@BotFather](https://t.me/BotFather) в Telegram
   - Отправьте команду `/newbot` и следуйте инструкциям
   - Скопируйте полученный токен в `.env`

6. Настройте Google таблицу:
   - Создайте новую Google таблицу
   - Скопируйте ID таблицы из URL (между `/d/` и `/edit`)
   - Вставьте ID в `.env` как `GOOGLE_SHEET_ID`
   - Бот автоматически создаст лист "Записи" с необходимыми колонками
   - Формат даты и времени в таблице: `DD.MM.YYYY HH:MM` (например, `21.12.2024 15:00`)
   - Вы можете редактировать время экзамена напрямую в таблице - напоминания автоматически пересчитаются

## Запуск

```bash
python bot.py
```

## Использование

1. Найдите вашего бота в Telegram
2. Отправьте команду `/start`
3. Следуйте инструкциям бота для записи на экзамен
4. После завершения регистрации вы получите ссылку на бланки

## Структура проекта

- `bot.py` - основной файл бота с логикой диалога
- `sheets.py` - модуль для работы с Google Sheets
- `scheduler.py` - модуль для управления напоминаниями
- `requirements.txt` - зависимости проекта
- `.env` - файл с переменными окружения (не включен в репозиторий)
- `credentials.json` - учетные данные Google Service Account (не включен в репозиторий)

## Переменные окружения

- `TELEGRAM_BOT_TOKEN` - токен Telegram бота
- `GOOGLE_SHEET_ID` - ID Google таблицы
- `GOOGLE_CREDENTIALS_PATH` - путь к файлу с учетными данными (по умолчанию `credentials.json`)
- `FORMS_LINK` - ссылка на бланки для заполнения

## Структура Google таблицы

Бот автоматически создает лист "Записи" со следующими колонками:
- Дата записи
- Telegram ID
- Имя пользователя
- Имя и фамилия
- Тип экзамена
- День
- Время
- **Дата и время экзамена** (формат: `DD.MM.YYYY HH:MM`) - можно редактировать вручную
- Преподаватель
- Напоминание за час отправлено (автоматически обновляется ботом)
- Напоминание за 15 минут отправлено (автоматически обновляется ботом)

## Примечания

- Бот использует московское время (Europe/Moscow) для всех операций с датами и временем
- Формат даты и времени в таблице: `DD.MM.YYYY HH:MM` - удобен для ручного редактирования
- Напоминания проверяются каждую минуту - бот автоматически находит записи, которым пора отправить напоминание
- Если вы измените время экзамена в таблице, напоминания автоматически пересчитаются при следующей проверке
- Данные сохраняются в Google Sheets в реальном времени
- Если напоминание уже отправлено (колонка содержит "Да"), оно не будет отправлено повторно